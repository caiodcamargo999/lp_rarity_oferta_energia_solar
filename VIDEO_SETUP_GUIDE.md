# üé¨ Guia de Configura√ß√£o de V√≠deos - Cloudflare R2

Este guia explica como configurar e hospedar v√≠deos de grande porte (1.7GB+) usando o Cloudflare R2 com S3 Compatibility API.

## üöÄ Vantagens do Cloudflare R2

- **üí∞ 10x mais barato** que Vercel Pro
- **üåç CDN global** inclu√≠do
- **üì± Sem taxas de egress**
- **üîí Seguran√ßa empresarial**
- **üìπ Suporte a v√≠deos grandes** (1.7GB+)
- **üîå API S3 compat√≠vel**

## üìã Pr√©-requisitos

1. Conta no Cloudflare
2. Bucket R2 configurado
3. Credenciais de acesso R2
4. V√≠deo otimizado (MP4 recomendado)

## ‚öôÔ∏è Configura√ß√£o Passo a Passo

### 1. Criar Bucket no Cloudflare R2

1. Acesse [Cloudflare Dashboard](https://dash.cloudflare.com)
2. V√° para **R2 Object Storage**
3. Clique em **Create bucket**
4. Nome: `rarity-videos`
5. Configure como **p√∫blico** (para acesso direto)

### 2. Obter Credenciais R2

1. No dashboard R2, v√° para **Manage R2 API tokens**
2. Clique em **Create API token**
3. Configure as permiss√µes:
   - **Object Read & Write** para o bucket `rarity-videos`
4. Copie as credenciais:
   - `Account ID`
   - `Access Key ID`
   - `Secret Access Key`

### 3. Configurar Vari√°veis de Ambiente

Crie um arquivo `.env.local` com:

```bash
# ===== CLOUDFLARE R2 CONFIGURATION =====
R2_ACCOUNT_ID=sua_account_id_aqui
R2_ACCESS_KEY_ID=sua_access_key_aqui
R2_SECRET_ACCESS_KEY=sua_secret_key_aqui
R2_BUCKET_NAME=rarity-videos

# ===== V√çDEO PRINCIPAL =====
NEXT_PUBLIC_VIDEO_URL=https://sua-account-id.r2.cloudflarestorage.com/rarity-videos/video-de-vendas.mp4

# ===== V√çDEO GOOGLE ADS (p√°gina /3) =====
NEXT_PUBLIC_VIDEO_URL_GOOGLEADS=https://sua-account-id.r2.cloudflarestorage.com/rarity-videos/video-google-ads.mp4

# ===== V√çDEO LANDING PAGES (futuro) =====
NEXT_PUBLIC_VIDEO_URL_LANDINGPAGES=https://sua-account-id.r2.cloudflarestorage.com/rarity-videos/video-landing-pages.mp4

# ===== CONFIGURA√á√ÉO DO SITE =====
NEXT_PUBLIC_SITE_URL=https://seu-dominio.com
NEXT_PUBLIC_SITE_URL_LOCAL=http://localhost:3000
NEXT_PUBLIC_SITE_URL_PROD=https://seu-dominio.com
```

### 4. Upload de V√≠deos

#### Op√ß√£o A: Via Script Automatizado (Recomendado)

```bash
# Instalar depend√™ncias (se necess√°rio)
npm install

# Upload do v√≠deo Google Ads para p√°gina /3
npm run upload-video-googleads

# Upload de outros v√≠deos
npm run upload-video video-landing-pages.mp4 landingpages
```

#### Op√ß√£o B: Via AWS CLI

```bash
# Configurar AWS CLI para R2
aws configure set aws_access_key_id sua_access_key
aws configure set aws_secret_access_key sua_secret_key
aws configure set region auto

# Upload do v√≠deo
aws s3 cp video-google-ads.mp4 s3://rarity-videos/video-google-ads.mp4 \
  --endpoint-url=https://sua-account-id.r2.cloudflarestorage.com
```

#### Op√ß√£o C: Via Interface Web

1. Acesse o bucket no Cloudflare Dashboard
2. Clique em **Upload**
3. Selecione seu arquivo de v√≠deo
4. Aguarde o upload completar
5. Copie a URL p√∫blica do arquivo

## üéØ Configura√ß√£o por P√°gina

### P√°gina Principal (/)
- **V√≠deo**: `video-de-vendas.mp4`
- **Vari√°vel**: `NEXT_PUBLIC_VIDEO_URL`
- **API Proxy**: `/api/video-proxy`

### P√°gina Google Ads (/3)
- **V√≠deo**: `video-google-ads.mp4`
- **Vari√°vel**: `NEXT_PUBLIC_VIDEO_URL_GOOGLEADS`
- **API Proxy**: `/api/video-proxy-googleads`
- **Componente**: `VideoSectionV3` com `videoId="googleads"`

### P√°gina Landing Pages (futuro)
- **V√≠deo**: `video-landing-pages.mp4`
- **Vari√°vel**: `NEXT_PUBLIC_VIDEO_URL_LANDINGPAGES`
- **API Proxy**: `/api/video-proxy-landingpages`
- **Componente**: `VideoSectionV3` com `videoId="landingpages"`

## üîß Estrutura de Arquivos

```
projeto/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ video-proxy/route.ts              # Proxy v√≠deo principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ video-proxy-googleads/route.ts    # Proxy v√≠deo Google Ads
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ video-proxy-landingpages/route.ts # Proxy v√≠deo Landing Pages
‚îÇ   ‚îî‚îÄ‚îÄ 3/page.tsx                            # P√°gina Google Ads
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ VideoSection.tsx                      # Componente original
‚îÇ   ‚îú‚îÄ‚îÄ VideoSectionV3.tsx                    # Componente multi-v√≠deo
‚îÇ   ‚îî‚îÄ‚îÄ OptimizedVideo.tsx                    # Player otimizado
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ upload-video-r2.js                    # Script Node.js
‚îÇ   ‚îî‚îÄ‚îÄ upload-video-r2.ps1                   # Script PowerShell
‚îî‚îÄ‚îÄ env-config-r2-videos.txt                  # Template de configura√ß√£o
```

## üöÄ Deploy no Vercel

### 1. Configurar Vari√°veis no Vercel

```bash
# Via CLI
vercel env add R2_ACCOUNT_ID production
vercel env add R2_ACCESS_KEY_ID production
vercel env add R2_SECRET_ACCESS_KEY production
vercel env add R2_BUCKET_NAME production
vercel env add NEXT_PUBLIC_VIDEO_URL_GOOGLEADS production

# Via Dashboard
# Acesse: https://vercel.com/dashboard
# V√° para: Settings > Environment Variables
# Adicione todas as vari√°veis do .env.local
```

### 2. Deploy

```bash
# Deploy para produ√ß√£o
vercel --prod

# Ou push para GitHub (se conectado)
git push origin main
```

## üß™ Testes

### 1. Teste Local

```bash
# Iniciar servidor de desenvolvimento
npm run dev

# Acessar p√°ginas
# http://localhost:3000 (p√°gina principal)
# http://localhost:3000/3 (p√°gina Google Ads)
```

### 2. Teste de URL do V√≠deo

```bash
# Testar URL direta do v√≠deo
curl -I https://sua-account-id.r2.cloudflarestorage.com/rarity-videos/video-google-ads.mp4

# Deve retornar:
# HTTP/2 200
# Content-Type: video/mp4
# Accept-Ranges: bytes
```

### 3. Teste de API Proxy

```bash
# Testar proxy local
curl -I http://localhost:3000/api/video-proxy-googleads

# Deve retornar:
# HTTP/1.1 200
# Content-Type: video/mp4
# Accept-Ranges: bytes
```

## üêõ Troubleshooting

### Erro: "URL do v√≠deo n√£o configurada"

**Causa**: Vari√°vel de ambiente n√£o definida
**Solu√ß√£o**: 
1. Verificar se `.env.local` existe
2. Verificar se vari√°vel est√° correta
3. Reiniciar servidor de desenvolvimento

### Erro: "Acesso negado ao v√≠deo"

**Causa**: Bucket n√£o √© p√∫blico ou credenciais incorretas
**Solu√ß√£o**:
1. Configurar bucket como p√∫blico
2. Verificar credenciais R2
3. Verificar permiss√µes do token

### Erro: "V√≠deo n√£o encontrado"

**Causa**: Arquivo n√£o foi uploadado ou nome incorreto
**Solu√ß√£o**:
1. Verificar se arquivo existe no bucket
2. Verificar nome do arquivo
3. Verificar URL completa

### V√≠deo n√£o carrega

**Causa**: Problemas de CORS ou headers
**Solu√ß√£o**:
1. Verificar headers do R2
2. Verificar configura√ß√£o CORS
3. Usar API proxy como fallback

## üìä Monitoramento

### M√©tricas Importantes

- **Tempo de carregamento**: < 3 segundos
- **Taxa de erro**: < 1%
- **Cache hit rate**: > 90%
- **Bandwidth**: Monitorar uso mensal

### Logs

```bash
# Ver logs do Vercel
vercel logs

# Ver logs espec√≠ficos do v√≠deo
vercel logs --filter="video-proxy"
```

## üí° Dicas de Otimiza√ß√£o

### 1. Compress√£o de V√≠deo

```bash
# Usar FFmpeg para otimizar
ffmpeg -i input.mp4 -c:v libx264 -crf 23 -c:a aac -b:a 128k output.mp4

# Para v√≠deos muito grandes
ffmpeg -i input.mp4 -c:v libx264 -crf 28 -preset slow -c:a aac -b:a 96k output.mp4
```

### 2. Thumbnails

- Criar thumbnails otimizados (JPG, 900x400px)
- Usar WebP para melhor compress√£o
- Implementar lazy loading

### 3. CDN

- Cloudflare R2 j√° inclui CDN global
- Configurar cache headers adequados
- Usar compress√£o gzip

## üìû Suporte

- **Documenta√ß√£o Cloudflare R2**: https://developers.cloudflare.com/r2/
- **API S3 Compatibility**: https://developers.cloudflare.com/r2/api/s3/
- **Vercel Environment Variables**: https://vercel.com/docs/concepts/projects/environment-variables

---

**üé¨ Pronto!** Seu v√≠deo de 1.7GB est√° configurado e otimizado para a p√°gina /3 usando Cloudflare R2!
