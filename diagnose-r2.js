// Script de diagn√≥stico para Cloudflare R2
const fs = require('fs');
const path = require('path'); // Added missing import for path

console.log('üîç DIAGN√ìSTICO DO CLOUDFLARE R2');
console.log('================================');

// ===== VERIFICAR CREDENCIAIS =====
console.log('\nüìã CREDENCIAIS CONFIGURADAS:');
console.log('Access Key ID:', '18d46aaf79c9700a7041bb9253f0efc4');
console.log('Secret Access Key:', '97ab4b36e10a7338ced2485465a01ddc81f2ab6d426925a09ab8e2ca272b228f');
console.log('Bucket Name:', 'vsl-solar-rarity-brasil');

// ===== TESTAR ENDPOINTS =====
console.log('\nüåê TESTANDO ENDPOINTS:');

const endpoints = [
  'https://18d46aaf79c9700a7041bb9253f0efc4.r2.cloudflarestorage.com',
  'https://vsl-solar-rarity-brasil.18d46aaf79c9700a7041bb9253f0efc4.r2.cloudflarestorage.com',
  'https://77f677cc90bcd810f75c80680f636a46.r2.cloudflarestorage.com'
];

async function testEndpoints() {
  for (const endpoint of endpoints) {
    try {
      console.log(`\nüîç Testando: ${endpoint}`);
      
      const response = await fetch(endpoint, {
        method: 'HEAD',
        signal: AbortSignal.timeout(10000)
      });
      
      console.log(`‚úÖ Status: ${response.status}`);
      console.log(`üìä Headers:`, Object.fromEntries(response.headers.entries()));
      
    } catch (error) {
      console.log(`‚ùå Erro: ${error.message}`);
    }
  }
}

// ===== VERIFICAR ARQUIVO LOCAL =====
console.log('\nüìÅ VERIFICA√á√ÉO DO ARQUIVO LOCAL:');
const videoPath = path.join(process.env.USERPROFILE || process.env.HOME, 'Downloads', 'video-de-vendas.mp4');

if (fs.existsSync(videoPath)) {
  const stats = fs.statSync(videoPath);
  const sizeMB = (stats.size / (1024 * 1024)).toFixed(2);
  console.log(`‚úÖ Arquivo encontrado: ${videoPath}`);
  console.log(`üìä Tamanho: ${sizeMB} MB`);
  console.log(`üìÖ √öltima modifica√ß√£o: ${stats.mtime}`);
} else {
  console.log(`‚ùå Arquivo n√£o encontrado: ${videoPath}`);
}

// ===== SOLU√á√ïES RECOMENDADAS =====
console.log('\nüîß SOLU√á√ïES RECOMENDADAS:');
console.log('1. Verifique se o bucket foi criado no dashboard do Cloudflare R2');
console.log('2. Confirme se as credenciais est√£o corretas');
console.log('3. Verifique se o bucket est√° marcado como p√∫blico');
console.log('4. Tente criar um novo bucket com nome diferente');
console.log('5. Use alternativa: Backblaze B2 (mais est√°vel)');

// ===== ALTERNATIVA BACKBLAZE B2 =====
console.log('\nüöÄ ALTERNATIVA RECOMENDADA: BACKBLAZE B2');
console.log('‚úÖ Mais est√°vel que Cloudflare R2');
console.log('‚úÖ Suporte nativo a S3 API');
console.log('‚úÖ Pre√ßos competitivos');
console.log('‚úÖ Sem problemas SSL');

// Executar testes
testEndpoints().catch(console.error);
