# Script para Resolver Problemas Locais - Rarity Agency
# Execute este script para limpar e reinicializar o projeto

Write-Host "üîß Resolvendo problemas locais do projeto Rarity Agency..." -ForegroundColor Green
Write-Host ""

# 1. Parar servidor se estiver rodando
Write-Host "1Ô∏è‚É£ Parando servidor de desenvolvimento..." -ForegroundColor Yellow
try {
    Get-Process -Name "node" -ErrorAction SilentlyContinue | Where-Object {$_.ProcessName -eq "node"} | Stop-Process -Force
    Write-Host "‚úÖ Servidor parado com sucesso" -ForegroundColor Green
} catch {
    Write-Host "‚ÑπÔ∏è Nenhum servidor rodando" -ForegroundColor Blue
}

# 2. Limpar cache do Next.js
Write-Host "2Ô∏è‚É£ Limpando cache do Next.js..." -ForegroundColor Yellow
if (Test-Path ".next") {
    Remove-Item -Recurse -Force ".next"
    Write-Host "‚úÖ Cache .next removido" -ForegroundColor Green
}

if (Test-Path "node_modules/.cache") {
    Remove-Item -Recurse -Force "node_modules/.cache"
    Write-Host "‚úÖ Cache node_modules removido" -ForegroundColor Green
}

# 3. Limpar arquivos tempor√°rios
Write-Host "3Ô∏è‚É£ Limpando arquivos tempor√°rios..." -ForegroundColor Yellow
$tempFiles = @("*.log", "*.tmp", "*.temp", "tsconfig.tsbuildinfo")
foreach ($pattern in $tempFiles) {
    Get-ChildItem -Path . -Filter $pattern -Recurse -ErrorAction SilentlyContinue | Remove-Item -Force
}
Write-Host "‚úÖ Arquivos tempor√°rios removidos" -ForegroundColor Green

# 4. Verificar depend√™ncias
Write-Host "4Ô∏è‚É£ Verificando depend√™ncias..." -ForegroundColor Yellow
if (Test-Path "package-lock.json") {
    Write-Host "üì¶ package-lock.json encontrado" -ForegroundColor Blue
} else {
    Write-Host "‚ö†Ô∏è package-lock.json n√£o encontrado, reinstalando depend√™ncias..." -ForegroundColor Yellow
    npm install
}

# 5. Reinstalar depend√™ncias (opcional)
$reinstall = Read-Host "üîÑ Deseja reinstalar todas as depend√™ncias? (s/n)"
if ($reinstall -eq "s" -or $reinstall -eq "S" -or $reinstall -eq "sim" -or $reinstall -eq "Sim") {
    Write-Host "üì¶ Removendo node_modules..." -ForegroundColor Yellow
    if (Test-Path "node_modules") {
        Remove-Item -Recurse -Force "node_modules"
    }
    
    Write-Host "üì¶ Reinstalando depend√™ncias..." -ForegroundColor Yellow
    npm install
    
    if ($LASTEXITCODE -eq 0) {
        Write-Host "‚úÖ Depend√™ncias reinstaladas com sucesso" -ForegroundColor Green
    } else {
        Write-Host "‚ùå Erro ao reinstalar depend√™ncias" -ForegroundColor Red
        exit 1
    }
}

# 6. Verificar arquivos cr√≠ticos
Write-Host "5Ô∏è‚É£ Verificando arquivos cr√≠ticos..." -ForegroundColor Yellow

$criticalFiles = @(
    "app/layout.tsx",
    "app/globals.css", 
    "app/page.tsx",
    "components/VideoSection.tsx",
    "next.config.js",
    "package.json"
)

foreach ($file in $criticalFiles) {
    if (Test-Path $file) {
        Write-Host "‚úÖ $file" -ForegroundColor Green
    } else {
        Write-Host "‚ùå $file - ARQUIVO CR√çTICO AUSENTE!" -ForegroundColor Red
    }
}

# 7. Verificar vari√°veis de ambiente
Write-Host "6Ô∏è‚É£ Verificando vari√°veis de ambiente..." -ForegroundColor Yellow
if (Test-Path ".env.local") {
    Write-Host "‚úÖ .env.local encontrado" -ForegroundColor Green
} else {
    Write-Host "‚ö†Ô∏è .env.local n√£o encontrado - criando template..." -ForegroundColor Yellow
    Copy-Item "env.example" ".env.local" -ErrorAction SilentlyContinue
    if (Test-Path ".env.local") {
        Write-Host "‚úÖ .env.local criado a partir do template" -ForegroundColor Green
    } else {
        Write-Host "‚ùå Erro ao criar .env.local" -ForegroundColor Red
    }
}

# 8. Verificar configura√ß√£o do Next.js
Write-Host "7Ô∏è‚É£ Verificando configura√ß√£o do Next.js..." -ForegroundColor Yellow
try {
    $nextConfig = Get-Content "next.config.js" -Raw
    if ($nextConfig -match "experimental.*appDir.*true") {
        Write-Host "‚ö†Ô∏è Configura√ß√£o experimental.appDir detectada - pode causar problemas" -ForegroundColor Yellow
    } else {
        Write-Host "‚úÖ Configura√ß√£o do Next.js parece correta" -ForegroundColor Green
    }
} catch {
    Write-Host "‚ùå Erro ao ler next.config.js" -ForegroundColor Red
}

# 9. Verificar TypeScript
Write-Host "8Ô∏è‚É£ Verificando configura√ß√£o TypeScript..." -ForegroundColor Yellow
if (Test-Path "tsconfig.json") {
    Write-Host "‚úÖ tsconfig.json encontrado" -ForegroundColor Green
} else {
    Write-Host "‚ùå tsconfig.json n√£o encontrado" -ForegroundColor Red
}

# 10. Iniciar servidor de desenvolvimento
Write-Host "9Ô∏è‚É£ Iniciando servidor de desenvolvimento..." -ForegroundColor Yellow
Write-Host ""
Write-Host "üöÄ Para iniciar o servidor, execute:" -ForegroundColor Cyan
Write-Host "   npm run dev" -ForegroundColor White
Write-Host ""
Write-Host "üåê O projeto estar√° dispon√≠vel em: http://localhost:3000" -ForegroundColor Cyan
Write-Host ""

# 11. Perguntar se quer iniciar agora
$startNow = Read-Host "üöÄ Deseja iniciar o servidor agora? (s/n)"
if ($startNow -eq "s" -or $startNow -eq "S" -or $startNow -eq "sim" -or $startNow -eq "Sim") {
    Write-Host "üöÄ Iniciando servidor..." -ForegroundColor Green
    npm run dev
} else {
    Write-Host ""
    Write-Host "üéØ Resumo das corre√ß√µes aplicadas:" -ForegroundColor Green
    Write-Host "   ‚úÖ Cache limpo" -ForegroundColor White
    Write-Host "   ‚úÖ Arquivos tempor√°rios removidos" -ForegroundColor White
    Write-Host "   ‚úÖ Depend√™ncias verificadas" -ForegroundColor White
    Write-Host "   ‚úÖ Arquivos cr√≠ticos verificados" -ForegroundColor White
    Write-Host "   ‚úÖ Vari√°veis de ambiente configuradas" -ForegroundColor White
    Write-Host ""
    Write-Host "üìù Para iniciar manualmente:" -ForegroundColor Yellow
    Write-Host "   npm run dev" -ForegroundColor White
}

Write-Host ""
Write-Host "üéØ Problemas resolvidos! Consulte TROUBLESHOOTING_VIDEO.md se ainda houver problemas." -ForegroundColor Green
